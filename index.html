<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ë™ë„¤ ì‹¤ì‹œê°„ ë‚ ì”¨</title>
    <style>
        /* 1. ë³´ê¸° ì¢‹ì€ ë””ìì¸ (CSS) */
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background: #eef2f3;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background: white;
            width: 360px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .control-group {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        button {
            width: 100%;
            padding: 15px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        button:hover {
            background: #357abd;
        }

        /* ë‚ ì”¨ ê²°ê³¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        #result-card {
            margin-top: 25px;
            display: none; /* ì²˜ìŒì— ìˆ¨ê¹€ */
        }

        .weather-main {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .temperature {
            font-size: 48px;
            font-weight: bold;
            color: #2d3436;
            margin: 10px 0;
        }

        .condition {
            font-size: 18px;
            color: #636e72;
            margin-bottom: 5px;
        }

        .update-time {
            font-size: 12px;
            color: #b2bec3;
        }

        .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .detail-item {
            background: #fff;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 12px;
        }

        .label { font-size: 12px; color: #888; display: block; margin-bottom: 5px; }
        .value { font-size: 16px; font-weight: bold; color: #333; }

    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸŒ¤ï¸ ì‹¤ì‹œê°„ ë‚ ì”¨ ì¡°íšŒ</h1>
        
        <div class="control-group">
            <select id="region-select">
                <option value="">ì‹œ/ë„ ì„ íƒ</option>
            </select>
        </div>
        <div class="control-group">
            <select id="city-select" disabled>
                <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
            </select>
        </div>

        <button onclick="getWeather()">ë‚ ì”¨ í™•ì¸í•˜ê¸°</button>

        <div id="result-card">
            <div class="weather-main">
                <div class="condition" id="pty-state">ì •ë³´ ì—†ìŒ</div>
                <div class="temperature" id="temp">--Â°</div>
                <div class="update-time" id="time-info">--:-- ê¸°ì¤€</div>
            </div>
            
            <div class="details">
                <div class="detail-item">
                    <span class="label">ğŸ’§ ìŠµë„</span>
                    <span class="value" id="humid">--%</span>
                </div>
                <div class="detail-item">
                    <span class="label">â˜” 1ì‹œê°„ ê°•ìˆ˜</span>
                    <span class="value" id="rain">--mm</span>
                </div>
                <div class="detail-item">
                    <span class="label">ğŸŒ¬ï¸ í’ì†</span>
                    <span class="value" id="wind">--m/s</span>
                </div>
                <div class="detail-item">
                    <span class="label">ğŸ§­ ë™ë„¤ ìœ„ì¹˜</span>
                    <span class="value" id="location-name">--</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. ì„¤ì •ê°’ (API í‚¤ ë° ì¢Œí‘œ ë°ì´í„°)
        const SERVICE_KEY = "d7c02f1982ff03f57db5df6f0f339ea3f0f8a65b9daa2d32cac45e4517d5a987";
        
        // ì„ ìƒë‹˜ì´ ì£¼ì‹  ì¢Œí‘œ ë°ì´í„° (ì£¼ìš” ì§€ì—­ ìƒ˜í”Œ)
        const gridData = {
            'ê²½ê¸°ë„': {
                'ê´‘ëª…ì‹œ': { nx: 58, ny: 125 },
                'ìˆ˜ì›ì‹œ': { nx: 60, ny: 121 },
                'ì•ˆì–‘ì‹œ': { nx: 59, ny: 122 },
                'ì„±ë‚¨ì‹œ': { nx: 62, ny: 123 },
                'ê³¼ì²œì‹œ': { nx: 61, ny: 124 },
                'ë¶€ì²œì‹œ': { nx: 56, ny: 124 }
            },
            'ì„œìš¸íŠ¹ë³„ì‹œ': {
                'ì¢…ë¡œêµ¬': { nx: 60, ny: 127 },
                'ê°•ë‚¨êµ¬': { nx: 61, ny: 126 }
            },
            'ë¶€ì‚°ê´‘ì—­ì‹œ': { 'í•´ìš´ëŒ€êµ¬': { nx: 98, ny: 76 } }
            // í•„ìš”í•˜ë©´ ì—¬ê¸°ì— ë°ì´í„°ë¥¼ ë” ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.
        };

        // 2. ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì´ˆê¸°í™”
        const regionSelect = document.getElementById('region-select');
        const citySelect = document.getElementById('city-select');

        // ì‹œ/ë„ ëª©ë¡ ì±„ìš°ê¸°
        Object.keys(gridData).forEach(region => {
            let option = document.createElement('option');
            option.value = region;
            option.text = region;
            regionSelect.add(option);
        });

        // ì‹œ/ë„ ë³€ê²½ ì‹œ ì‹œ/êµ°/êµ¬ ëª©ë¡ ì±„ìš°ê¸°
        regionSelect.addEventListener('change', (e) => {
            citySelect.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
            citySelect.disabled = true;
            
            if (e.target.value) {
                const cities = gridData[e.target.value];
                Object.keys(cities).forEach(city => {
                    let option = document.createElement('option');
                    option.value = city;
                    option.text = city;
                    citySelect.add(option);
                });
                citySelect.disabled = false;
            }
        });

        // 3. í•µì‹¬ ê¸°ëŠ¥: ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°
        async function getWeather() {
            const region = regionSelect.value;
            const city = citySelect.value;

            if (!region || !city) {
                alert("ì§€ì—­ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            // ë¡œë”© í‘œì‹œ
            document.querySelector('button').innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
            
            // ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°
            const { nx, ny } = gridData[region][city];

            // ì‹œê°„ ìë™ ê³„ì‚° (ë§¤ì‹œ 40ë¶„ ì—…ë°ì´íŠ¸ ë¡œì§)
            const now = new Date();
            // 45ë¶„ ì „ì´ë©´ 1ì‹œê°„ ì „ ë°ì´í„°ë¥¼ ìš”ì²­ (ì„œë²„ ì œê³µ ì‹œê°„ ê³ ë ¤)
            if (now.getMinutes() < 45) {
                now.setHours(now.getHours() - 1);
            }

            const year = now.getFullYear();
            const month = ('0' + (now.getMonth() + 1)).slice(-2);
            const day = ('0' + now.getDate()).slice(-2);
            const baseDate = `${year}${month}${day}`;
            const baseTime = ('0' + now.getHours()).slice(-2) + '00';

            // API ì£¼ì†Œ ì¡°ë¦½
            let url = `http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst`;
            url += `?serviceKey=${SERVICE_KEY}`;
            url += `&pageNo=1&numOfRows=1000&dataType=JSON`;
            url += `&base_date=${baseDate}&base_time=${baseTime}`;
            url += `&nx=${nx}&ny=${ny}`;

            // CORS ì—ëŸ¬ ë°©ì§€ìš© í”„ë¡ì‹œ (ìˆ˜ì—…ìš©)
            const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);

            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();

                if (data.response.header.resultCode !== '00') {
                    throw new Error("ë°ì´í„° ì˜¤ë¥˜");
                }

                // ë°ì´í„° íŒŒì‹±
                const items = data.response.body.items.item;
                let weather = { temp: '-', humid: '-', rain: '-', wind: '-', pty: '0' };

                items.forEach(item => {
                    if (item.category === "T1H") weather.temp = item.obsrValue;
                    if (item.category === "REH") weather.humid = item.obsrValue;
                    if (item.category === "RN1") weather.rain = item.obsrValue;
                    if (item.category === "WSD") weather.wind = item.obsrValue;
                    if (item.category === "PTY") weather.pty = item.obsrValue;
                });

                // í™”ë©´ ì—…ë°ì´íŠ¸
                updateUI(weather, baseDate, baseTime, city);

            } catch (error) {
                console.error(error);
                alert("ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n(ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”)");
            } finally {
                document.querySelector('button').innerText = "ë‚ ì”¨ í™•ì¸í•˜ê¸°";
            }
        }

        // 4. í™”ë©´ í‘œì‹œ í•¨ìˆ˜
        function updateUI(weather, date, time, city) {
            document.getElementById('result-card').style.display = "block";
            
            document.getElementById('temp').innerText = `${weather.temp}Â°`;
            document.getElementById('humid').innerText = `${weather.humid}%`;
            document.getElementById('rain').innerText = `${weather.rain}mm`;
            document.getElementById('wind').innerText = `${weather.wind}m/s`;
            document.getElementById('location-name').innerText = city;

            // ì‹œê°„ í¬ë§·íŒ… (ì˜ˆ: 1700 -> 17ì‹œ 00ë¶„)
            const timeStr = `${time.substring(0,2)}:${time.substring(2,4)}`;
            document.getElementById('time-info').innerText = `${timeStr} ê¸°ì¤€ ë°ì´í„°`;

            // ê°•ìˆ˜ í˜•íƒœ(PTY) ì½”ë“œë¥¼ ê¸€ìë¡œ ë³€í™˜
            const ptyState = {
                '0': 'ë§‘ìŒ/íë¦¼ (ë¹„ ì•ˆ ì˜´)',
                '1': 'ë¹„ â˜”',
                '2': 'ë¹„/ëˆˆ ğŸŒ§ï¸',
                '3': 'ëˆˆ â„ï¸',
                '5': 'ë¹—ë°©ìš¸ ğŸ’§',
                '6': 'ë¹—ë°©ìš¸/ëˆˆë‚ ë¦¼',
                '7': 'ëˆˆë‚ ë¦¼'
            };
            document.getElementById('pty-state').innerText = ptyState[weather.pty] || "ìƒíƒœ ì •ë³´ ì—†ìŒ";
        }
    </script>
</body>
</html>